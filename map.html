<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map | Campus Navigator</title>

  <!-- Your existing CSS -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />

  <style>
  #map {
    width: 100%;
    height: 500px;
    border-radius: 10px;
    margin-top: 20px;
    position: relative;
  }

  /* Search box better spaced */
  #searchBox {
    position: absolute;
    top: 110px;
    left: 50%;
    transform: translateX(-50%);
    background: #fff;
    padding: 14px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(0,0,0,0.25);
    z-index: 9999;
    width: 80%;
    max-width: 420px;
  }

  #searchInput {
    width: 100%;
    padding: 12px;
    border-radius: 6px;
    border: 1px solid #aaa;
    font-size: 16px;
  }

  #results {
    background: #fff;
    margin-top: 8px;
    max-height: 220px;
    overflow-y: auto;
    border-radius: 6px;
    border: 1px solid #ddd;
  }

  .result-item {
    padding: 12px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    font-size: 15px;
  }

  .result-item:hover {
    background: #f4f4f4;
  }

  /* Routing instruction panel on right side */
  .leaflet-routing-container {
    width: 280px !important;
    max-height: 450px;
    overflow-y: auto;
    right: 10px !important;
    top: 140px !important;
    position: absolute !important;
    background: white !important;
    border-radius: 10px !important;
    box-shadow: 0 0 12px rgba(0,0,0,0.25) !important;
    z-index: 5000 !important;
  }

  .leaflet-routing-collapse-btn {
    display: none !important;
  }
</style>

</head>
<body>

  <header>
    <h1>Campus Navigator</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="map.html">Map</a>
      <a href="search.html">Search</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main>
    <h2>Campus Map</h2>
    <p>Navigate anywhere inside SNS Institutions with real-time GPS.</p>

    <div id="searchBox">
      <input id="searchInput" type="text" placeholder="Search SNS Campus Locations..." />
      <div id="results"></div>
    </div>

    <div id="map"></div>
  </main>

  <footer>Â© 2025 Campus Navigator. All rights reserved.</footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  <script>
    // -----------------------------
    // SNS CAMPUS MAP INITIALIZATION (Satellite View)
    // -----------------------------
    const map = L.map("map").setView([11.1001, 76.9979], 17);

    // ðŸŒ Satellite Tile Layer (FREE + No API Key)
    L.tileLayer(
      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
      {
        maxZoom: 22,
        attribution: "Â© Esri â€” Satellite Imagery"
      }
    ).addTo(map);

    // -----------------------------
    // SNS CAMPUS LOCATION DATA (Real Coordinates)
    // -----------------------------
    const locations = [
  { name: "Department of Mechatronics", coords: [11.100529192537177, 77.02716309751852] },
  { name: "SNS College of Technology", coords: [11.100223380401568, 77.0263032549085] },
  { name: "Department of Civil Engineering", coords: [11.09970735808378, 77.02662250608721] },
  { name: "Drone Lab", coords: [11.099867430069743, 77.02710087807108] },
  { name: "EEE Department", coords: [11.100028631248655, 77.02716936371525] },
  { name: "Biomedical Engineering", coords: [11.099821214534456, 77.02727305857348] },
  { name: "SNS Innovation Hub", coords: [11.100135086477035, 77.02737773434725] },
  { name: "SNS College of Physiotherapy", coords: [11.100925866632158, 77.02788457393324] },
  { name: "SNS College of Allied and Health Science", coords: [11.100825385932994, 77.02791968866512] },
  { name: "SNS College of Pharmacy and Health Sciences", coords: [11.10113412323229, 77.02756865392408] },
  { name: "Department of Mechanical Engineering", coords: [11.101357676038338, 77.02717030733425] },
  { name: "SNS College of Engineering Shuttle Court", coords: [11.101948973464541, 77.02757892717494] },
  { name: "SNS Open Auditorium", coords: [11.102587750264112, 77.02791180027195] },
  { name: "Department of Electrical and Electronics Engineering", coords: [11.103363334550187, 77.027408910633] },
  { name: "SNS College of Engineering Canteen", coords: [11.103424306439646, 77.02771362593705] },
  { name: "SPINE - The SNS Activity Center", coords: [11.104013006202337, 77.02642810329823] }


    ];

    locations.forEach(loc => {
      L.marker(loc.coords).bindPopup(`<b>${loc.name}</b>`).addTo(map);
    });

    // -----------------------------
    // LIVE USER LOCATION TRACKING
    // -----------------------------
    let userMarker;

    function trackUser() {
      navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          if (!userMarker) {
            userMarker = L.marker([lat, lon], { title: "You" })
              .addTo(map)
              .bindPopup("You are here");
          } else {
            userMarker.setLatLng([lat, lon]);
          }
        },
        () => alert("Please enable GPS for live navigation."),
        { enableHighAccuracy: true }
      );
    }

    trackUser();

    // -----------------------------
    // SEARCH SYSTEM
    // -----------------------------
    const searchInput = document.getElementById("searchInput");
    const resultsDiv = document.getElementById("results");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      resultsDiv.innerHTML = "";

      if (query === "") return;

      const matched = locations.filter(loc =>
        loc.name.toLowerCase().includes(query)
      );

      matched.forEach(loc => {
        const div = document.createElement("div");
        div.classList.add("result-item");
        div.textContent = loc.name;
        div.onclick = () => {
          startRouting(loc.coords);
          resultsDiv.innerHTML = "";   // hide results
          searchInput.value = "";   };   // clear search box
        resultsDiv.appendChild(div);
      });
    });

    // -----------------------------
    // ROUTING SYSTEM (Like Google Maps)
    // -----------------------------
    let routeControl;

    function startRouting(destination) {
      navigator.geolocation.getCurrentPosition((pos) => {
        const userLoc = [pos.coords.latitude, pos.coords.longitude];

        if (routeControl) {
          map.removeControl(routeControl);
        }

        routeControl = L.Routing.control({
          waypoints: [
            L.latLng(userLoc[0], userLoc[1]),
            L.latLng(destination[0], destination[1])
          ],
          lineOptions: {
            addWaypoints: false
          },
          router: L.Routing.osrmv1({
            serviceUrl: "https://router.project-osrm.org/route/v1"
          }),
        }).addTo(map);
      });
    }
  </script>
</body>
</html>
